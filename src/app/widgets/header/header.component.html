<!-- Header Section -->
<div class="header-holder">
    <a routerLink="/"><img src="../../../assets/images/logo.png" alt="logo" class="logo"></a>

    <!-- Tabs inside header -->
        <app-search-bar></app-search-bar>

    <div class="right-content-holder">


        <!-- Filter Dropdown Button -->
        <div class="filter-wrapper">
            <button class="filter-btn" (click)="toggleFilterDropdown()" [class.active]="filterDropdownOpen">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
            </button>

            <!-- Filter Dropdown Menu -->
            <div class="filter-dropdown" *ngIf="filterDropdownOpen" [@slideDown]>
                <div class="filter-menu">
                    <!-- Left Side: Main Categories -->
                    <div class="filter-main-menu">
                        <div class="filter-menu-item" 
                             *ngFor="let filter of filterOptions"
                             (mouseenter)="selectFilter(filter.key)"
                             (click)="selectFilter(filter.key)"
                             [class.active]="selectedFilter === filter.key">
                            <span class="filter-label">{{ filter.label }}</span>
                            <span class="filter-count">({{ getFilterCount(filter.key) }})</span>
                            <span class="filter-arrow">›</span>
                        </div>
                    </div>

                    <!-- Right Side: Sub Items -->
                    <div class="filter-sub-menu" *ngIf="selectedFilter">
                        <!-- Categories -->
                        <div class="filter-sub-content" *ngIf="selectedFilter === 'categories'">
                            <h4 class="sub-menu-title">Categories</h4>
                            <div class="sub-menu-grid">
                                <a *ngFor="let category of getFilteredItems('categories')"
                                   [routerLink]="['/home/category', category.categoryName, 'category']"
                                   class="sub-menu-item"
                                   (click)="closeFilterDropdown()">
                                    <span>{{ category.categoryName }}</span>
                                </a>
                            </div>
                            <button *ngIf="categories.length > 8" 
                                    class="view-all-btn" 
                                    (click)="expandFilter('categories')">
                                {{ expandedFilters['categories'] ? 'Show Less' : 'View All (' + categories.length + ')' }}
                            </button>
                        </div>

                        <!-- Use Cases -->
                        <div class="filter-sub-content" *ngIf="selectedFilter === 'usecases'">
                            <h4 class="sub-menu-title">Use Cases</h4>
                            <div class="sub-menu-grid">
                                <a *ngFor="let usecase of getFilteredItems('usecases')"
                                   [routerLink]="['/home/category', usecase.usecaseName, 'usecase']"
                                   class="sub-menu-item"
                                   (click)="closeFilterDropdown()">
                                    <span>{{ usecase.usecaseName }}</span>
                                </a>
                            </div>
                            <button *ngIf="useCases.length > 8" 
                                    class="view-all-btn" 
                                    (click)="expandFilter('usecases')">
                                {{ expandedFilters['usecases'] ? 'Show Less' : 'View All (' + useCases.length + ')' }}
                            </button>
                        </div>

                        <!-- Technology -->
                        <div class="filter-sub-content" *ngIf="selectedFilter === 'technology'">
                            <h4 class="sub-menu-title">Technologies</h4>
                            <div class="sub-menu-grid">
                                <a *ngFor="let tech of getFilteredItems('technology')"
                                   [routerLink]="['/home/category', tech.technologyName, 'technology']"
                                   class="sub-menu-item"
                                   (click)="closeFilterDropdown()">
                                    <span>{{ tech.technologyName }}</span>
                                </a>
                            </div>
                            <button *ngIf="technologies.length > 8" 
                                    class="view-all-btn" 
                                    (click)="expandFilter('technology')">
                                {{ expandedFilters['technology'] ? 'Show Less' : 'View All (' + technologies.length + ')' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        

        <div class="auth-function-holder">
            <a routerLink="/home/battle-card" class="vs-btn">Vs</a>
            <a routerLink="/auth/sign-up" *ngIf="!isuserloggedin">Sign Up</a>
            <a routerLink="/auth/log-in" *ngIf="!isuserloggedin">Log in</a>

            <div class="profile-wrapper" *ngIf="isuserloggedin" (click)="toggleDropdown()">
                <div class="profile-avatar">{{ userInitials }}</div>
                <div class="profile-dropdown" *ngIf="dropdownOpen">
                    <ul>
                        <li><a routerLink="/home/user-profile">Profile</a></li>
                        <li><a (click)="showLogoutConfirm = true">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filter Dropdown Overlay -->
<div class="filter-overlay" *ngIf="filterDropdownOpen" (click)="closeFilterDropdown()"></div>

<!-- Tab Dropdown Overlay -->
<div class="tab-dropdown-overlay" *ngIf="activeTab" [@slideDown] (click)="closeDropdown()">
    <div class="tab-dropdown-container" (click)="$event.stopPropagation()">
        <div class="tab-dropdown-content">
            <!-- Categories Dropdown -->
            <div *ngIf="activeTab === 'categories'">
                <div class="dropdown-grid">
                    <a *ngFor="let category of categories.slice(0, showAllCategories ? categories.length : 6)"
                        [routerLink]="['/home/category', category.categoryName, 'category']" class="dropdown-item"
                        (click)="closeDropdown()">
                        <span>{{ category.categoryName }}</span>
                    </a>
                </div>
                <button *ngIf="categories.length > 6" class="see-more-btn" (click)="toggleShowAll('categories')">
                    {{ showAllCategories ? 'Show Less' : 'See More' }}
                    <span class="btn-arrow">{{ showAllCategories ? '▲' : '▼' }}</span>
                </button>
            </div>

            <!-- Use Cases Dropdown -->
            <div *ngIf="activeTab === 'usecases'">
                <div class="dropdown-grid">
                    <a *ngFor="let useCase of useCases.slice(0, showAllUseCases ? useCases.length : 6)"
                        [routerLink]="['/home/category', useCase.usecaseName, 'usecase']" class="dropdown-item"
                        (click)="closeDropdown()">
                        <span>{{ useCase.usecaseName }}</span>
                    </a>
                </div>
                <button *ngIf="useCases.length > 6" class="see-more-btn" (click)="toggleShowAll('usecases')">
                    {{ showAllUseCases ? 'Show Less' : 'See More' }}
                    <span class="btn-arrow">{{ showAllUseCases ? '▲' : '▼' }}</span>
                </button>
            </div>

            <!-- Technology Dropdown -->
            <div *ngIf="activeTab === 'technology'">
                <div class="dropdown-grid">
                    <a *ngFor="let tech of technologies.slice(0, showAllTechnologies ? technologies.length : 6)"
                        [routerLink]="['/home/category', tech.technologyName, 'technology']" class="dropdown-item"
                        (click)="closeDropdown()">
                        <span>{{ tech.technologyName }}</span>
                    </a>
                </div>
                <button *ngIf="technologies.length > 6" class="see-more-btn" (click)="toggleShowAll('technology')">
                    {{ showAllTechnologies ? 'Show Less' : 'See More' }}
                    <span class="btn-arrow">{{ showAllTechnologies ? '▲' : '▼' }}</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Logout Modal -->
<div class="modal-backdrop" *ngIf="showLogoutConfirm" (click)="showLogoutConfirm = false">
    <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-content">
            <h3 class="modal-title">Are you sure?</h3>
            <p class="modal-warning">
                Do you really want to log out of your account? You will need to log in again to access your data.
            </p>
            <div class="modal-actions">
                <button class="cancel-btn" (click)="showLogoutConfirm = false">Cancel</button>
                <button class="confirm-btn" (click)="onLogout()">Yes, Log Out</button>
            </div>
        </div>
    </div>
</div>